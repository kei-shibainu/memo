# 02_DB設計メモ
## 論理設計と物理設計
### 論理設計
+ DB設計は概念スキーマ(論理設計)→内部スキーマ(物理設計)の順に行う。
+ 論理設計のステップ
    + エンティティの抽出
    + エンティティの定義
    + エンティティの正規化
    + エンティティのER図の作成
+ エンティティは直訳すると`実体`。
+ まずは`実体`の抽出と属性の定義を決める。
+ 実体の抽出後は歪なエンティティになるため正規化を実施して整理する。
+ 正規化実施後はエンティティが小さくなるため各間の関連性を示したER図(Entity-Relationship)を作成する。

### 物理設計
+ 物理設計のステップ
    + テーブル定義
    + インデックス定義
    + ハードウェアサイジング
    + ストレージの冗長構成決定
    + ファイルの物理配置決定
+ まずは論理設計時のエンティティをテーブル定義に変換する
+ パフォーマンス向上のためにインデックス(索引)定義を作成する
+ サイジングは`容量`の意味。キャパシティとパフォーマンスの両面からストレージのサイジングを行う。
+ パフォーマンスのサイジングは「どれだけ早いか(応答時間)」、「どれだけ多いか(スループット)」の指標が必要。
+ 正確な見積もりは難しいため、スケーラビリティ(拡張性)に富んだ構成にする必要がある。
+ 複数のディスクを束ねて一つの仮想的なストレージとして扱う技術をRAIDという。
+ RAIDはRedundant Array of Independent Disksの、日本語に訳すと「独立したディスクの冗長配列」
+ 信頼性(ディスクの冗長化)、性能面(ディスクの分散化)の両面で利用される
+ RAIDの種類
    + RAID0 ストライピング(縞々模様)
    + RAID1 ミラーリング
    + RAID5 パリティ
    + RAID10 RAID0と1の複合構成
+ 推奨順。RAID10 => RAID5 >> RAID1 >>>>>>>>>>>>>> RAID0
+ ファイル
    + データファイル
    + インデックスファイル
    + システムファイル
    + 一時ファイル
    + ログファイル
+ データファイルとインデックスファイルはファイル容量が比較的高く、また永続的にサイズが大きくなるため、独立したディスクに配置する。

### レプリケーション
+ 現用系と待機系からなる複数のDBサーバを用意して現用系から待機系にデータを更新(レプリカを作成)する技術。
+ これによりフェールセーフを実現できる。

### クラウドの冗長構成
+ AWSはRAID5とRAID6を推奨していない。
+ AWSは作成時にデータがレプリケートされるためRAIDで冗長性を担保する必要がない。
+ AWSでは商用サービスの場合マルチAZ構成(現用系に障害が発生した場合自動的にフェイルオーバー)を取る。

### バックアップ
+ フルバックアップ（完全バックアップ）
+ 差分バックアップ 
+ 増分バックアップ

### リストア
+ リストア  
フルバックアップのファイルをデータベースに戻す。
+ リカバリ  
差分（または増分）バックアップしていたトランザクションログを適用する。 
+ ロールフォワード  
データベースサーバーに残っているトランザクションログを適用する。  

## 参考
[達人に学ぶDB設計徹底指南書 第2版](https://www.amazon.co.jp/dp/B0D8N5G9GT)